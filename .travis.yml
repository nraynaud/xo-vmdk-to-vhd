language: node_js
node_js:
  - "4.4"
addons:
  apt:
    packages:
      - uuid-dev
      - build-essential
      - qemu-utils
install:
  - npm install
  - wget https://github.com/rubiojr/vhd-util-convert/archive/master.tar.gz -O /tmp/vhd-util-convert.tar.gz
  - tar -xvf /tmp/vhd-util-convert.tar.gz
  - cd vhd-util-convert-master && make
  - dd if=/dev/random of=data bs=512 count=1
  - qemu-convert -fraw -Ovmdk -o subformat=streamOptimized data test.vmdk
  - qemu-convert -fvmdk -Ovpc test.vmdk test.vhd
  - ./vhd-util-convert-master/vhd-util scan test.vhd
  - qemu-convert -fvpc -Oraw data test.vhd test.result
  - diff data test.result
script:
  - npm test
